<!DOCTYPE html>
<!-- Learn Systems Biology by Yong-Jun Shin (csml.uconn.edu), 2016
     Module 9: Parameter Estimation using an Adaptive Filter 
     Modified by Rachel Winsor for Assignment 2-->

    <head>
        <meta name="description" content="Learn Systems Biology, Introduction to Systems Biology">
        <meta name="author" content="Yong-Jun Shin (UCONN Computational and Systems Medicine Lab, 2016)">
        <!-- Cascading Style Sheet (CSS) for the simulation layout-->
        <link rel="stylesheet" href="css/sim.css">
        <!-- Cascading Style Sheet (CSS) for the sidebar menu-->
        <link rel="stylesheet" href="css/menu.css">
        <!-- bootstrap.css http://getbootsrap.com -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <!-- w3.css http://www.w3schools.com/w3css/ -->
        <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
        <!-- jquery https://jquery.com -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <!-- bootstrap.js http://getbootsrap.com -->
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <!-- ace.js: an embeddable code editor written in JavaScript https://ace.c9.io -->
        <script src="http://rawgithub.com/ajaxorg/ace-builds/master/src-noconflict/ace.js"></script>
        <!-- pltly.js: the open source JavaScript graphing library https://plot.ly/javascript -->
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <!-- http://www.filosophy.org/post/35/normaldistributed_random_values_in_javascript_using_the_ziggurat_algorithm/ -->
        <script src="js/random.js"></script>
    </head>

    <body>
        <!-- Sidebar Menu -->
        <div id="wrapper">
            <div id="sidebar-wrapper">
                <ul class="sidebar-nav w3-large">
                    <li class="sidebar-brand "></li>
                    <li>
                        <a href="index.html">Module 1</a>
                    </li>
                    <li>
                        <a href="module2.html">Module 2</a>
                    </li>
                    <li>
                        <a href="module3.html">Module 3</a>
                    </li>
                    <li>
                        <a href="module4.html">Module 4</a>
                    </li>
                    <li>
                        <a href="module5.html">Module 5</a>
                    </li>
                    <li>
                        <a href="module6.html">Module 6</a>
                    </li>
                    <li>
                        <a href="module7.html">Module 7</a>
                    </li>
                    <li>
                        <a href="module8.html">Module 8</a>
                    </li>
                    <li>
                        <a href="module9.html">Module 9</a>
                    </li>
                    <li>
                        <a href="module10.html">Module 10</a>
                    </li>
                    <li>
                        <a href="module11.html">Module 11</a>
                    </li>
                    <li>
                        <a href="module12.html">Module 12</a>
                    </li>
                    <li>
                        <a href="module13.html">Module 13</a>
                    </li>
                    <li>
                        <a href="module14.html">Module 14</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Title -->
        <div id = "header" class="container">
            <h3><b> Module 9: Parameter Estimation using an Adaptive Filter</b></h3>
            <h4>UCONN BioMEMs Course <font color="#a9a9a9"> BME6086 </font> </a></h4>
        </div>

        <!-- Navigation -->
        <div id = "navigation" class="container">
            <a href="module8.html"><i class="glyphicon glyphicon-chevron-left w3-xxlarge"></i></a>
            <a href="module10.html"><i class="glyphicon glyphicon-chevron-right w3-xxlarge"></i></a>
        </div>

        <!-- User interface -->
        <button id ="run" class="w3-btn w3-ripple w3-teal w3-large" onclick="run()">Run</button>
        <button id ="reset" class="w3-btn w3-ripple w3-red w3-large" onclick="history.go(0)">Reset</button>
        <div id = "checkbox">
            <input id = "xProtein" class="w3-check" type="checkbox" >
            <label class="w3-medium ">Show x protein</label> <br>
            <input id = "yProtein" class="w3-check" type="checkbox" checked="checked">
            <label class="w3-medium">Show y protein</label><br>
            <input id = "hold" class="w3-check" type="checkbox">
            <label class="w3-medium">Hold</label>
        </div>
        <ol id = "guide">
            <li class = "w3-large" >Modify the JavaScript code below</li>
            <li class = "w3-large" >Check/uncheck checkboxes</li>
            <li class = "w3-large" >Press [Run]</li>
        </ol>

        <!-- Chart -->
        <div id="chart"></div>

        <!-- Code editor with default text -->
        <div id="editor">
    N = 281;                  // total number of data points
    x = new Array(N);         // x protein concentration (uM)
    y = new Array(N);         // y protein concentration (uM)
    X = 30;                   // constant x protein concentration
    //x[0] = X;                 // initial x protein concentration
    //y[0] = 0;                 // initial y protein concentration
    pXY = 0.4;                // production parameter
    pY = 0.8;                 // degradation/dilution parameter

    // we replace fake data generation with info from our assignment
    x = [ ];
    y = [0, 5.43996, 6.42086, 7.790265, 9.15967, 6.3503, 5.9253, 14.47019, 5.9253, 4.88729, 4.91375, 4.94021, 4.88729, 18.57689, 6.70626, 7.780715, 8.85517, 6.70626, 8.71706, 10.72786, 9.925155, 9.12245, 9.12245, 9.12646, 10.18327, 10.455565, 10.72786, 10.455565, 10.18327, 10.18327, 10.18388, 11.207, 7.17196, 3.13692, 4.139295, 5.14167, 3.45219, 3.2003, 3.45219, 8.56509, 6.55122, 8.57987, 7.32384, 7.52245, 5.81095, 7.28333, 6.043, 7.32384, 7.45973, 7.59562, 8.20377, 7.08765, 7.12105, 7.09027, 7.31186, 6.67676, 7.31186, 8.13139, 8.16545, 8.16545, 7.9795, 7.79355, 8.013835, 8.23412, 8.23412, 8.33923, 8.44434, 7.98157, 8.44434, 8.335095, 8.22585, 8.410065, 8.59428, 7.77695, 8.59428, 8.22585, 8.22585, 7.961435, 7.8292275, 7.69702, 7.84696, 7.9969, 8.00864, 8.02038, 7.98683, 7.970055, 7.95328, 7.22336, 7.23802, 7.25268, 7.37597, 6.59428, 7.37597, 6.99532, 6.98041, 6.245435, 5.51046, 3.80414, 4.24586, 5.72415, 5.90109, 5.71302, 3.27178, 3.16819, 3.116395, 3.0646, 3.0646, 3.0646, 2.637045, 2.4232675, 2.20949, 9.30821, 10.18869, 6.59964, 5.826645, 5.05365, 7.62117, 10.18869, 10.21898, 9.22701, 8.731025, 8.23504, 8.73656, 8.617855, 8.49915, 8.50341, 10.24404, 9.60663, 10.24404, 9.06393, 7.9649, 8.36618, 8.76746, 8.13206, 8.76746, 8.36618, 8.16554, 7.9649, 7.507695, 7.05049, 7.67482, 7.91119, 7.91168, 7.88692, 5.05748, 5.486645, 5.91581, 5.05748, 5.05748, 5.05748, 5.6326, 5.14136, 5.060155, 4.97895, 4.94069, 4.94811, 5.37001, 5.79191, 5.91484, 6.03777, 6.03418, 5.775725, 5.6464975, 5.51727, 6.20766, 6.58863, 6.58863, 6.12406, 5.65949, 6.54818, 6.543675, 6.53917, 6.543675, 6.54818, 7.05073, 3.76569, 7.05073, 7.44793, 7.48054, 7.48054, 7.06174, 6.4781, 7.06174, 7.5309, 7.5309, 7.37865, 3.67165, 6.45639, 6.86429, 7.68656, 7.757665, 7.7932175, 7.81099375, 7.82877, 8.516, 5.53625, 5.53625, 5.53625, 5.898265, 6.26028, 5.58379, 5.245545, 4.9073, 4.64738, 2.43747, 2.21983, 2.43747, 7.84897, 6.2059, 7.84897, 4.72999, 6.67378, 7.12664, 6.08169, 6.08169, 6.340175, 6.59866, 6.31442, 6.59866, 6.72372, 9.34115, 10.649865, 11.95858, 6.24799, 6.5489, 6.92311, 7.598415, 8.27372, 4.79057, 4.44404, 4.79057, 6.19428, 7.61788, 6.29556, 8.31563, 3.17847, 3.52238, 7.50809, 7.5764, 7.64471, 7.39708, 6.91472, 7.39708, 7.05633, 7.05633, 7.05633, 8.27372, 7.61788, 8.27372, 3.49513, 8.31563, 8.30651, 8.71807, 8.21703, 8.71807, 7.98619, 7.94653, 7.90687, 9.09574, 8.54307, 9.09574, 3.49757, 3.49988, 3.49513, 2.96673, 4.039995, 5.11326, 8.06673, 8.07293, 8.07293, 8.10547, 7.53412, 8.10547, 8.34562, 8.34574, 8.16588, 2.37798, 2.35401, 2.37798, 8.3747, 8.39708];

    // adaptive parameter estimation (Least Mean Squares (LMS) method)
    est_pXY = new Array(N);   // estimated production parameter set
    est_pY = new Array(N);    // estimated degradation/dilution parameter set
    est_y = new Array(N);     // y protein concentration (uM)
    error = new Array(N);     // estimation error (y - est_y)
    est_pXY[1] = 0;           // initial guess for pXY
    est_pY[1] = 0;            // initial guess for pY
    u = 0.0001;               // step size

    for (n = 1; n < N-1; n++) // N-2 loops (1 loop = 1 min)
    {
        est_pXY[n+1] = est_pXY[n] + u*x[n-1]*(y[n]-(x[n-1]*est_pXY[n] + y[n-1]*est_pY[n]));
        est_pY[n+1] = est_pY[n] + u*y[n-1]*(y[n]-(x[n-1]*est_pXY[n] + y[n-1]*est_pY[n]));
        est_y[n+1] = x[n]*est_pXY[n+1] + y[n]*est_pY[n+1];
        error[n+1] = y[n+1] - est_y[n+1];
    }
        </div>

        <!-- Code editor with default text -->
        <script>
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/eclipse");
            editor.getSession().setMode("ace/mode/javascript");
            editor.setFontSize(16);
            var random = new randomGaussain();


            // Execute when [Run] is clicked
            $( "#run" ).click(function() {
                var chart = document.getElementById('chart');
                var code = editor.getValue();
                eval(code);
                xData = {name: "x protein", x: n, y: x};
                yData = {name: "y protein", x: n, y: y};
                estY = {name: "estimated y protein", x: n, y: est_y};
                estError = {name: "estimation error", x: n, y: error};
                data = [];
                if (document.getElementById('xProtein').checked) {
                    data.push (xData);
                }
                if (document.getElementById('yProtein').checked) {
                    data.push (yData);
                }
                data.push (estY);
                data.push (estError);
                layout = {
                    xaxis: {title: 'time [min]'},
                    yaxis: {title: 'protein concentration [uM]'},
                    margin: {t: 40},
                };

                if (document.getElementById('hold').checked) {
                    Plotly.plot(chart, data, layout);
                } else {
                    Plotly.newPlot(chart, data, layout);
                }
            });
        </script>
    </body>
</html>
